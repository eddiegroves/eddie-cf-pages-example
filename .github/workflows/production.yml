name: Deploy to Cloudflare Pages
on:
  push:
    branches:
      - main
jobs:
  poll-cf-deploy:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Build
        run: make build
      - name: Deploy production
        run: |
          npx wrangler pages publish dist/ \
          --project-name=eddie-cf-pages-example \
          --branch=production \
          --commit-hash=${{ github.sha }} \
          --commit-message="${{github.event.head_commit.message}}"
        env:
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
